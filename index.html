<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Excel Database</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    input[type="text"] { width: 100%; padding: 6px; }
    .actions button { margin: 0 4px; }
  </style>
</head>
<body>
  <h1>ğŸ“Š Excel-style Client Tracker</h1>
  <input type="text" id="search" placeholder="Search by code or name" />
  <form id="entryForm">
    <input type="text" id="clientName" placeholder="Client Name" required />
    <input type="text" id="clientPhone" placeholder="Client Phone" required />
    <input type="file" id="offerImage" accept="image/*" required />
    <input type="file" id="drawingImage" accept="image/*" required />
    <button type="submit">Add</button>
  </form>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Code</th><th>Name</th><th>Phone</th><th>Offer</th><th>Drawing</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDgOby-sJuIUs8iCErmqtiMbqMuND5ZtCo",
      authDomain: "ala5tsas-alturkey-stats.firebaseapp.com",
      databaseURL: "https://ala5tsas-alturkey-stats-default-rtdb.firebaseio.com",
      projectId: "ala5tsas-alturkey-stats",
      storageBucket: "ala5tsas-alturkey-stats.appspot.com",
      messagingSenderId: "649675735929",
      appId: "1:649675735929:web:f90a49614895c6958ea5a8",
      measurementId: "G-X2FHKZT21J"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const storage = getStorage();
    const tableBody = document.querySelector("#dataTable tbody");
    const form = document.getElementById("entryForm");
    const searchInput = document.getElementById("search");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = form.clientName.value.trim();
      const phone = form.clientPhone.value.trim();
      const offerFile = form.offerImage.files[0];
      const drawingFile = form.drawingImage.files[0];

      const key = push(ref(db, "clients"), {}).key;

      const offerRef = sRef(storage, `offers/${key}`);
      const drawingRef = sRef(storage, `drawings/${key}`);
      const offerSnap = await uploadBytes(offerRef, offerFile);
      const drawingSnap = await uploadBytes(drawingRef, drawingFile);

      const offerURL = await getDownloadURL(offerSnap.ref);
      const drawingURL = await getDownloadURL(drawingSnap.ref);

      await set(ref(db, `clients/${key}`), {
        id: key,
        name,
        phone,
        offer: offerURL,
        drawing: drawingURL
      });

      form.reset();
    });

    function renderTable(data) {
      tableBody.innerHTML = "";
      Object.entries(data).forEach(([id, item], index) => {
        if (!item.name.toLowerCase().includes(searchInput.value.toLowerCase()) && !id.includes(searchInput.value)) return;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${id}</td>
          <td>${item.name}</td>
          <td>${item.phone}</td>
          <td><a href="${item.offer}" target="_blank">ğŸ“„</a></td>
          <td><a href="${item.drawing}" target="_blank">ğŸ“Š</a></td>
          <td class="actions">
            <button onclick="confirmClient('${id}')">âœ… Confirm</button>
            <button onclick="editClient('${id}')">âœï¸ Edit</button>
            <button onclick="window.open('contract.html?id=${id}')">ğŸ“‘ Contract</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });
    }

    onValue(ref(db, "clients"), (snapshot) => {
      const data = snapshot.val() || {};
      renderTable(data);
    });

    searchInput.addEventListener("input", () => {
      onValue(ref(db, "clients"), (snapshot) => {
        const data = snapshot.val() || {};
        renderTable(data);
      }, { onlyOnce: true });
    });

    window.confirmClient = async (id) => {
      alert("Client " + id + " confirmed!");
    };

    window.editClient = (id) => {
      alert("Edit client " + id);
    };
  </script>
</body>
</html>

<!-- contract.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client Contract</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    img { max-width: 100%; height: auto; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ“„ Client Contract</h2>
  <div id="contract"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDgOby-sJuIUs8iCErmqtiMbqMuND5ZtCo",
      authDomain: "ala5tsas-alturkey-stats.firebaseapp.com",
      databaseURL: "https://ala5tsas-alturkey-stats-default-rtdb.firebaseio.com",
      projectId: "ala5tsas-alturkey-stats",
      storageBucket: "ala5tsas-alturkey-stats.appspot.com",
      messagingSenderId: "649675735929",
      appId: "1:649675735929:web:f90a49614895c6958ea5a8",
      measurementId: "G-X2FHKZT21J"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const id = new URLSearchParams(window.location.search).get("id");

    get(child(ref(db), `clients/${id}`)).then(snap => {
      if (snap.exists()) {
        const data = snap.val();
        document.getElementById("contract").innerHTML = `
          <p><strong>Client Name:</strong> ${data.name}</p>
          <p><strong>Phone:</strong> ${data.phone}</p>
          <p><strong>Contract:</strong><br><img src="${data.offer}" /></p>
          <p><strong>Accounts:</strong><br><img src="${data.drawing}" /></p>
        `;
      }
    });
  </script>
</body>
</html>
